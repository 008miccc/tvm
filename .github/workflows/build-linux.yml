name: TVM Linux Wheel

on:
  workflow_dispatch:

jobs:
  build-linux:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install system dependencies
        run: |
          sudo apt update
          sudo apt install -y python3-dev python3-pip python3-setuptools python3-wheel \
                             cmake ninja-build llvm-dev libtinfo-dev zlib1g-dev libedit-dev

      - name: Configure TVM build
        run: |
          mkdir build
          cp tvm/cmake/config.cmake build/ || true
          cd build
          cmake -G Ninja ../tvm \
            -DUSE_LLVM=ON \
            -DUSE_RPC=ON \
            -DUSE_GRAPH_EXECUTOR=ON

      - name: Build TVM C++ core
        run: |
          cd build
          ninja -j 2

      - name: Build and package Python wheel
        run: |
          python3 -m pip install --upgrade pip wheel setuptools
          cd tvm/python
          python3 setup.py bdist_wheel
          mkdir -p ../../wheel-linux
          cp dist/*.whl ../../wheel-linux/ || true

      - name: Upload wheel artifact
        uses: actions/upload-artifact@v4
        with:
          name: tvm-linux-wheel
          path: wheel-linux/*.whl
